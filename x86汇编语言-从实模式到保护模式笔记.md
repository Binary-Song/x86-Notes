# x86汇编语言-从实模式到保护模式笔记

## 第二章 处理器、内存和指令

### 2.2 寄存器和算术逻辑部件

8086具有16位寄存器，可以容纳16比特。

1 byte = 8 bit

1 word = 2 byte = 16 bit

1 double word = 2 word = 32 bit

算术逻辑部件（ALU）读取寄存器的数字，计算后将结果写入寄存器。

### 2.3 内存储器

内存单次能按字节、字、双字和四字进行访问。

### 2.4 指令和指令集

8086指令的长度可变。

对于内存中的一个字，Intel处理器采用小端序（Little Endian）。即数的低位放在小地址处，高位放在大地址处。例如，如果从地址0000开始存放数005D，则0000处为5D，0001处为00。

### 2.5 古老的Intel 8086处理器

8086有8个通用寄存器：

- **AX** （Accumulator）

- **BX** （Base Register）

- **CX** （Count Register）

- **DX** （Data Register）

- **SI** （Source Index）

- **DI** （Destination Index）

- **BP** （Base Pointer）

- **SP**（Stack Pointer）

其中AX、BX、CX、DX可以分为AH、AL、BH、BL、CH、CL、DH、DL。用来将16位寄存器拆成2个8位寄存器访问。

段可以重叠，每个段最大的长度是64KB

物理地址 =（段地址 << 4） + 逻辑地址

8086有4个段寄存器

- **CS** （Code Segment）
- **DS**（Data Segment）
- **ES**（Extra Segment）
- **IP**（Instruction Pointer）

## 第三章 汇编语言和汇编软件

### 3.1 汇编语言简介

`mov ax, 0x3f`相当于`ax = 0x3f`

`add bx ax`相当于`bx = ax + bx`

### 3.2 NASM 编译器

编译文件`nasm -f bin exam.asm -o exam.bin`

## 第四章 虚拟机的安装和使用

各个操作系统可能对程序有要求，不满足要求不能识别。所以要绕过该限制，就要在虚拟机上运行，把程序安装到MBR即可。

BIOS（基本输入输出系统）是固化在只读存储器（ROM）中的，它是开机执行的指令，占据内存顶端的64KB，范围0xF0000~0xFFFFF；DRAM则占据低端的640KB，范围0x00000~0x9FFFF。中间的部分0xA0000~0xE9999分给了其他外围设备。

指令从0xFFFF0处执行，一般这里是一个跳转。

如果设置为从硬盘启动，ROM-BIOS将读取MBR的内容，将它加载到0x0000:0x7c00。然后跳到那里执行。

## 第五章 编写主引导扇区代码

### 5.3 在屏幕上显示文字

显卡有文字模式，还有图形模式。

0xB8000~0xBFFFF是留给显卡的。

**不允许用`mov`将一个立即数传送到段寄存器，必须通过中转。**

字符由2个字节表示，低位为ASCII码，高位为显示属性。显示属性前4位是前景色，后四4位是背景色。如下图：

低位 → 高位

K R<sub>f</sub> G<sub>f</sub> B<sub>f</sub> I R<sub>b</sub> G<sub>b</sub> B<sub>b</sub>

K是闪烁位，I是高亮位。

其余表示前景色或背景色。

方括号`[]`表示对地址解引用。

### 5.4 显示标号的汇编地址

指令前面可以由标号，表示此处的汇编地址（程序开头为0）。